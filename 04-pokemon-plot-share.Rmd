# plot types

### geom_count

```{r}

df |> 
  # filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      y = Type2,
      colour = series_gen
    )
  ) +
  # geom_quasirandom(groupOnX = FALSE, size = .3,) +
  geom_count(alpha = .3) +
  scale_size_area() +
  scale_colour_identity() +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
ggsave("./output/ReleaseDate-TypeCount.png", width = 1500, height = 1000, unit = "px")
```
2020年代のTrainerはちょっとおかしい気が…
Stadiumは一時期Stadiumというカテゴリだったが、今はTrainerのサブカテゴリ
[supporter](https://bulbapedia.bulbagarden.net/wiki/Supporter_card_(TCG))
[item](https://bulbapedia.bulbagarden.net/wiki/Item_card_(TCG))
[trainer](https://bulbapedia.bulbagarden.net/wiki/Trainer_card_(TCG))


### 折れ線

```{r}
df |> 
  filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = Type
      # fill = colour
    )
  ) +
  geom_area(stat = "bin") +
  theme_minimal() +
  scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
ggsave("./output/ReleaseDate-TypeCountArea.png", width = 1500, height = 1000, unit = "px")
```

### series type ~  cards_total~ time
```{r}

df_series |> 
  # filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      y = series_class,
      size = cards_total,
      # colour = gen
    )
  ) +
  # geom_quasirandom(groupOnX = FALSE, size = .3,) +
  geom_jitter(alpha = .3,width = 0, height = .1) +
  scale_size_area() +
  scale_colour_identity() +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```


## シェア争い



## proportion, frequency
[make geom_area proportional](https://stackoverflow.com/questions/45438665/create-proportional-geom-area-plot-directly-in-ggplot2)
```{r}
df |> 
  filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = Type
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
ggsave("./output/ReleaseDate-TypeCountAreaShare.png", width = 1500, height = 1000, unit = "px")
```
### highlight fairies

```{r}
df |> 
  filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = Type == "Fairy"
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```
### highlight secret cards

```{r}
df |> 
  filter(Type %in% major_types) |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = is_secret_card
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```


```{r}
df |> 
  filter(Type %in% major_types,
         !is.na(is_secret_card)) |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = is_secret_card
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```
### set size ~ time
```{r}
df_series |> colnames()
df_series |> 
  ggplot(
    aes(
      x = release_date, 
     y = cards_total,
     colour = series_class
    )
  ) +
    geom_smooth(size = .2, se = FALSE) +
  geom_text(aes(label = series_abb), size = 1.2) +
  theme_minimal() +
  # facet_wrap(facets = vars(series_class)) +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    # legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```
### series class frequency ~ time

```{r}
df_series |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = series_class
      # fill = colour
    )
  ) +
  geom_area(stat = "bin") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

perhaps geom_density better?

リリース頻度
```{r}
df_series |> 
  ggplot(
    aes(
      x = release_date, 
      y = ..density..,
      fill = series_class
      # fill = colour
    )
  ) +
  geom_density(
    position = "stack",
    adjust = .4
    ) +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

実際の枚数
```{r}
df_series |> 
  ggplot(
    aes(
      x = release_date, 
      y = cards_total,
      fill = series_class
      # fill = colour
    )
  ) +
  geom_density(
    # position = "stack",
    adjust = .4
    ) +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

```{r}
df |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = Type == "Water"
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

## secret cards

```{r}
df |> 
  ggplot(
    aes(
      x = release_date, 
      # y = Type,
      fill = is_secret_card
      # fill = colour
    )
  ) +
  geom_area(stat = "bin", position = "fill") +
  theme_minimal() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```
いろいろなものが復活しうる。継承がカード→カードではないため。

## pokemon genes 

### pokemon gen share

TODO: ビンをMonthにしたい…
```{r}
df_gene$release_date[1] |> is.Date()
df_gene |> 
  # mutate(release_month = ym(release_date)) |> View()
  ggplot(
    aes(x = release_date,
        group_by = pokemon_gen |> as.factor(),
        fill = pokemon_gen) 
  ) +
  geom_bar(
    colour = "white",
    size = .2,
    stat = "bin",
    # position = "fill",
    bins = 100
    ) +
  theme_minimal() +
  scale_fill_viridis_c() +
  # scale_fill_manual(values = colours_named_vector) +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
    
```
新しいGenがリリースされると一気にそれが多くなるが、しばらくするとかなり偏りがなくなってくる（平衡状態みたいな）。第1世代はそれにしても多い気がするのでバイアスが検出できるかもしれない。

### pokemon number 

```{r}
# df_gene$id[1] |> is.integer()
df_gene |> 
  ggplot(aes(x = release_date, y = id, colour = pokemon_gen)) +
  geom_point(size = .1) +
  # geom_vline(xintercept = "2011-03-11" |> as.POSIXct()) +
  scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```
こうやって見ると3.11の直後はあまり余力がなく、ただ新世代はだしたいのでそこに注力したというのがありありと浮かんでくる。・・・と思ったのだが、それ以前からなんかやる気ないね？直後に以前の世代が少ないのもよくわからないし。用意は前からしていただろうから。しばらくして足りないのはわかる。

中央値はどのへんに？
```{r}
# df_gene$id[1] |> is.integer()
df_gene |> 
  ggplot(aes(x = release_date, y = id, colour = pokemon_gen)) +
    geom_line(data = df_gene |> group_by(series) |> summarise(release_date, pokemon_gen, id_median = median(id, na.rm = TRUE)), aes(y = id_median), colour = "black", size = 1.2) +
  geom_point(size = .1) +

  # geom_vline(xintercept = "2011-03-11" |> as.POSIXct()) +
  scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

初出と最新をハイライトできたら面白いかもしれない。
```{r}
# df_gene$id[1] |> is.integer()
df_gene_first_last <- df_gene |> 
  select(release_date, id, pokemon_gen, pokemon_name) |> 
  group_by(id) |> 
  mutate(first_appeared = min(release_date),
         last_appeared = max(release_date)) |> 
  select(-release_date) |> 
  pivot_longer(cols = ends_with("_appeared"), values_to = "date")
df_gene_first_last |> View()
df_gene |> 
  ggplot(aes(x = release_date, y = id)) +
  # geom_point(size = .1, alpha = .3, colour = "grey30") +
  geom_point(data = df_gene_first_last |> filter(name == "first_appeared"), aes(x = date), size = .3, colour = "red") +
  geom_point(data = df_gene_first_last |> filter(name == "last_appeared"), aes(x = date), size = .3, colour = "blue") +
  geom_text(data = df_gene_first_last |> filter(name == "last_appeared"), aes(x = date, label = pokemon_name), size = 3, colour = "blue", hjust = 0) +
  # geom_vline(xintercept = "2011-03-11" |> as.POSIXct()) +
  scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
ggsave("./output/id-date_first_last_appeared.png", width = 1500, height = 1000, unit = "px", dpi =100)

```
ピチューが2010年移行出てないだと？？pikachu使いたいからか？
```{r}
df_gene |> 
  filter(pokemon_name == "Pichu")
```

idではなくpokemon_genで
```{r}
# df_gene$id[1] |> is.integer()
df_gene |> 
  ggplot(aes(x = release_date, y = pokemon_gen, colour = pokemon_gen)) +
  geom_count() +
  geom_vline(xintercept = "2011-03-11" |> as.POSIXct()) +
  geom_smooth() +
  scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```



```{r}
# df_gene$id[1] |> is.integer()
df_gene |> 
  ggplot(aes(x = release_date, y = id, colour = Type2)) +
  geom_point(size = .1) +
  # scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```

#### poke deco

```{r}
# df_gene$id[1] |> is.integer()
df_gene |> 
  ggplot(aes(x = release_date, y = id, colour = pokemon_deco)) +
    geom_point(colour = "grey30") +
  geom_text(aes(label = pokemon_deco), size = 2) +
  # scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```



```{r}
df_gene |> 
  ggplot(aes(x = release_date, y = id, colour = pokemon_deco)) +
    geom_point(colour = "grey30") +
  geom_text(aes(label = pokemon_deco), size = 2) +
  # scale_colour_viridis_c() +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
```


### id ~ types ~ deco

```{r}
df_gene |> 
  ggplot(aes(x = id, fill = pokemon_gen |> as.factor())) +
  geom_bar() +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid = element_blank(),
    axis.line = element_line(size = .3),
    axis.ticks = element_line(size = .1)
  )
  # coord_flip()
```
これをランダムにドローしたときと比べてみたい。
単なる枚数だとかわいい（けど実戦では使われない）弱いたねポケモンが多くなる気がする。それにさらにGXとかが加わって手を変え品を変え再利用する。

リリース直後に多くなるのはミュージシャンのセトリとかでもそうだし、ファーストアルバムが結局みんなに好かれがち（Oasisの「けっきょくRadioheadにはみんなCreepしか期待していない」）というのも似ている。
リリース直後ご祝儀をモデルに組み込んでみるか。
すべてリリースごとにわけて、どれくらいで落ち着くか（平衡状態になるか）を見られそう。

```{r}
df_gene |> select(-is_pokemon, -meta_is_v325_only, -meta_is_bulba_only) |> 
  summarise(across(where(is.logical), ~ sum(.))) |> 
  summarise(across(everything(), ~ sum(.))) |> 
  pivot_longer(cols = everything()) |> 
  mutate(name = fct_reorder(name, desc(value))) |> 
  ggplot(aes(x = name, y = value)) +
  geom_point() +
  coord_flip()
```

