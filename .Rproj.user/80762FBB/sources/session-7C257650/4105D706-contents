---
title: "R Notebook"
output: html_notebook
---
# 個別のポケモン

## まずはなにもせずカウント
```{r}
df_poke_count_raw <- df |> 
  group_by(Name) |> 
  summarise(n = n()) |> 
  arrange(desc(n))

```

### ECDF

[負うた子に教えられて浅瀬を渡る](https://qiita.com/xerroxcopy/items/b79635ef3dbcc29644c6)

```{r}

df_count_full_name <- df_gene |> 
  group_by(Name) |> 
  summarise(n = n()) |> 
  arrange(desc(n)) |> 
  mutate(ecdf = 1 - ecdf(n)(n - .01)) |>
  select(-Name) |> 
  distinct()

df_count_pokemon <- df_gene |> 
  group_by(pokemon_name) |> 
  summarise(n = n()) |> 
  arrange(desc(n)) |> 
  mutate(ecdf = 1 - ecdf(n)(n - .01)) |>
  select(-pokemon_name) |> 
  distinct() 
```

`ecdf()`はX > nである割合であってX >= nである割合ではないのだな
やりたいこと的には、`n = 1`のときに、1以上のコピーがあるポケカの割合は1になってないとおかしい。n = 1のときに1よりもたくさんのコピーがある割合1 - .32とかを計算してしまっている。同様にn = 58のとき（ピカチュウさん）、X >= 58である割合は 1 / 2425 (2425はユニークなポケモン名の数、`df$Name |> unique() |> length()`)かと思うが、0になってしまっている、つまりX > 58である割合を計算している。
# ```{r}
# df$Name |> unique() |> length()
# 1/ 0.0004123711 
# ```

## plot ECDF

### full name

```{r}
df_count_full_name |> 
  ggplot(
    aes(
      x = n, 
      y = ecdf
    )
  ) +
  geom_point() +
  scale_x_continuous(
    trans = "log10", 
    breaks = 10^(0:10)
  ) +
  scale_y_continuous(
    trans = "log10", breaks = 10^(0:-10)) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    panel.background = element_rect(size = .3),
    axis.ticks = element_line(size = .1),
    aspect.ratio = 1
  )
```
### poke name

```{r}
df_count_pokemon |> 
  ggplot(
    aes(
      x = n, 
      y = ecdf
    )
  ) +
  geom_point() +
  scale_x_continuous(
    trans = "log10", 
    breaks = 10^(0:10)
  ) +
  scale_y_continuous(
    trans = "log10", breaks = 10^(0:-10)) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    panel.background = element_rect(size = .3),
    axis.ticks = element_line(size = .1),
    aspect.ratio = 1
  )
```
## 

つぎに、1999-2005, 1999-2010, 1999-2015,みたいにして探る。ピカチュウが流行ったのって何年くらいだっけ？その影響はありそう。gganimateみたいなやつを使えればいいけど、ちょっとむずかしいかも。



```{r}

df_poke_count <- df |> 
  group_by(Name) |> 
  summarise(n = n()) |> 
  arrange(desc(n)) |> 
  mutate(ecdf = 1 - ecdf(n)(n)) |> 
  select(-Name) |> 
  distinct() |> 
  mutate(ecdf = ecdf |> lead(default = 1))
df_poke_count |> 
  ggplot(
    aes(
      x = n, 
      y = ecdf
    )
  ) +
  geom_point() +
  scale_x_continuous(
    trans = "log10", 
    breaks = 10^(0:10)
  ) +
  scale_y_continuous(
    trans = "log10", breaks = 10^(0:-10)) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    panel.background = element_rect(size = .3),
    axis.ticks = element_line(size = .1),
    aspect.ratio = 1
  )
```
